DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'MigrationsDemo.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '202202182100309_AddBlogUrl'
BEGIN
    CREATE TABLE [dbo].[Blogs] (
        [BlogId] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        [Url] [nvarchar](max),
        [Rating] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Blogs] PRIMARY KEY ([BlogId])
    )
    CREATE TABLE [dbo].[Posts] (
        [PostId] [int] NOT NULL IDENTITY,
        [Title] [nvarchar](200),
        [Content] [nvarchar](max),
        [BlogId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Posts] PRIMARY KEY ([PostId])
    )
    CREATE INDEX [IX_BlogId] ON [dbo].[Posts]([BlogId])
    ALTER TABLE [dbo].[Posts] ADD CONSTRAINT [FK_dbo.Posts_dbo.Blogs_BlogId] FOREIGN KEY ([BlogId]) REFERENCES [dbo].[Blogs] ([BlogId]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202202182100309_AddBlogUrl', N'MigrationsDemo.Migrations.Configuration',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9797D6B077917592C2E83A0EA264D1B78096C60E518A54452AB051F4CBFAD04FEA2F74A89B254AF22DEB4D8B05820D397338333C339C51FEF9EBEFC18765C8C90BC48A493174CE7AA70E01E1CB8089C5D049F4FCDD8FCE87F7DF7E33B80EC225F95CC85D1839D4146AE83C6B1DF55D57F9CF1052D50B991F4B25E7BAE7CBD0A58174CF4F4F7F72CFCE5C400807B10819DC2742B310D25FF0D791143E443AA17C2203E02A5FC71D2F4525B7340415511F86CE842D62AAD10A7505A174C8256714ADF080CF1D4285903ADDED3F2AF0742CC5C28B7081F28755042837A75C416E7B7F2DBEAB1BA7E7C60D77AD5840F989D232DC13F0EC228F8B6BAB1F145DA78C1B46EE1A23AC57C6EB347A43E723970B87D807F5473C364276607B46FC84D4174F4A062051CCBF13324AB84E62180A48744CF909B94B669CF9BFC0EA41FE06622812CEAB76A165B8575BC0A5BB584610EBD53DCC2BD68E0387B8755DD7562E552DBDCCA7B1D017E70EB94523E88C4379FD15FF3D2D63F81904A09F10DC51AD21C6DB1B079006B06181759EF9599C867CC3B471C8842E3F8158E8670C2A5D3AE4862D212856720B1E05C32C43251D27B0ED90C7981FFD8C7B0C8701DE1C380BE396BEB0451A470BED4E2AAD1C720F3C63CF338BB21CED999DA78C8B37B10CEF25CFC5D3C5A7071A2F40A319D2DEF16412FB960903774DF38DE437307B90DF88BF21F9CDF18790BFD0FB5AE47F609A6F623FD6A62FC04C7C1D34DA73F40CD8AD74EC9A0119C5F74F8082E6CD042852639704B8544AFA2C3DBAC28DECD8BA03D722209D3664012FACC69823E1598414C72387CE0F8D68B4819519BD06CBBCAF839D39765E4CC51570D0402EFDEC451D51E5D3A079071883A0BE82A904B1E130E5C81E85C9C9846EE61D133E8B28EF32D952D8E39D324695F0F6CE1544204C8675C5FD75E796F05690B6C564E05648D32CA6260B5103E28A0169662EDB0A2B765F796D5579F2D94431981EE80A1ABE176B32D798D260595D397F6C1ACA19672DE58A9375843C272BFB8D84B563BD29774A234BFB1A57B5295B2AEA796C6CD2D71D69A909E58DADDB6937EBA78BBEDBED68BC07131A4558642B8D78BE42BCAC0B1FBDF3F66F51C30CC3F5554BA75A5A5B9E846F135D80B56B9E83006E58ACF415D574464D4D1E056143ACCACF0EFA14275529D8BCA3825485B4F97FA6D1D231B7E46EAE7783CE8426E9D337D7BADEA65A3AFB504EE38E476A2479128ACDB5A01B25EB5AAB18D9CAEE08694B5A05481776D72FDACD2A44B1D64419B856141B55AF714F8D27A27EE93B51224BDC575022AD40FB53A25DAD2B9445D7570D657B07B90925EFE5AA20F9D2EE1865A75645291777C7D98FE4472547A398DA22E5E96551B58AE7202F64DB3F6D342A5B26E2100CCF0B0B4C55F3564A43D833023DEF773EE22C0D6D2130A182CD41E96CFCC0FEFBECDCFA42F2DFF95AE12A15F01D3E59BCD9C7036622BB7542DA36206CF85E205E68EC3FD3F8BB902EBFAF22EDF94DE05538F5B93FF579A34BFB8DDC6F36FC1EE5F26AF36E11F5E6C4BBDF0558E3EDAB2EB385C08DD67C8CC3C172E8FC91AAF4C9F8D7A74CEB844C632C217D724AFE3C9003874C9D59D7FD3587C37ADB7DC0947BD074D9D11D1E6DA2FC7F4C91CD667EFB9CD8392666CFE5D00966126F35636FFBF0D43641760E906DB0AD23DD9166CBAACFEB8961DB38D998408F3341369B1BE448E5AF3BC84DC5166B08F3B71E017E8D1DA5CC58CC654152CBA242C42A7813D03440EA5CC69ACDA9AF71DB07A5D217ED33E5098A5C873308C6629AE828D1E83284335EFBB269C8BEE9FC744CAEDB3C98466993FF255C403319BA0053F131613C28EDBE69A9BB1D10268BF267CEDCA536CFDD625522DD4AB123501EBE32F91F208C3882A9A9F0E80B1C62DBA3824FB0A0FEAAE851BB41B65F443DEC832B4671DC0A558EB1D6C75F91C341B87CFF2FAB15BCB0E41C0000 , N'6.4.4')
END

IF @CurrentMigration < '202202182101301_AddPostClass'
BEGIN
    CREATE TABLE [dbo].[Posts] (
        [PostId] [int] NOT NULL IDENTITY,
        [Title] [nvarchar](200),
        [Content] [nvarchar](max),
        [BlogId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Posts] PRIMARY KEY ([PostId])
    )
    CREATE INDEX [IX_BlogId] ON [dbo].[Posts]([BlogId])
    CREATE UNIQUE INDEX [IX_Title] ON [dbo].[Posts]([Title])
    ALTER TABLE [dbo].[Blogs] ADD [Rating] [int] NOT NULL DEFAULT 3
    ALTER TABLE [dbo].[Posts] ADD CONSTRAINT [FK_dbo.Posts_dbo.Blogs_BlogId] FOREIGN KEY ([BlogId]) REFERENCES [dbo].[Blogs] ([BlogId]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202202182101301_AddPostClass', N'MigrationsDemo.Migrations.Configuration',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9797D6B077917592C2E83A0EA264D1B78096C60E518A54452AB051F4CBFAD04FEA2F74A89B254AF22DEB4D8B05820D397338333C339C51FEF9EBEFC18765C8C90BC48A493174CE7AA70E01E1CB8089C5D049F4FCDD8FCE87F7DF7E33B80EC225F95CC85D1839D4146AE83C6B1DF55D57F9CF1052D50B991F4B25E7BAE7CBD0A58174CF4F4F7F72CFCE5C400807B10819DC2742B310D25FF0D791143E443AA17C2203E02A5FC71D2F4525B7340415511F86CE842D62AAD10A7505A174C8256714ADF080CF1D4285903ADDED3F2AF0742CC5C28B7081F28755042837A75C416E7B7F2DBEAB1BA7E7C60D77AD5840F989D232DC13F0EC228F8B6BAB1F145DA78C1B46EE1A23AC57C6EB347A43E723970B87D807F5473C364276607B46FC84D4174F4A062051CCBF13324AB84E62180A48744CF909B94B669CF9BFC0EA41FE06622812CEAB76A165B8575BC0A5BB584610EBD53DCC2BD68E0387B8755DD7562E552DBDCCA7B1D017E70EB94523E88C4379FD15FF3D2D63F81904A09F10DC51AD21C6DB1B079006B06181759EF9599C867CC3B471C8842E3F8158E8670C2A5D3AE4862D212856720B1E05C32C43251D27B0ED90C7981FFD8C7B0C8701DE1C380BE396BEB0451A470BED4E2AAD1C720F3C63CF338BB21CED999DA78C8B37B10CEF25CFC5D3C5A7071A2F40A319D2DEF16412FB960903774DF38DE437307B90DF88BF21F9CDF18790BFD0FB5AE47F609A6F623FD6A62FC04C7C1D34DA73F40CD8AD74EC9A0119C5F74F8082E6CD042852639704B8544AFA2C3DBAC28DECD8BA03D722209D3664012FACC69823E1598414C72387CE0F8D68B4819519BD06CBBCAF839D39765E4CC51570D0402EFDEC451D51E5D3A079071883A0BE82A904B1E130E5C81E85C9C9846EE61D133E8B28EF32D952D8E39D324695F0F6CE1544204C8675C5FD75E796F05690B6C564E05648D32CA6260B5103E28A0169662EDB0A2B765F796D5579F2D94431981EE80A1ABE176B32D798D260595D397F6C1ACA19672DE58A9375843C272BFB8D84B563BD29774A234BFB1A57B5295B2AEA796C6CD2D71D69A909E58DADDB6937EBA78BBEDBED68BC07131A4558642B8D78BE42BCAC0B1FBDF3F66F51C30CC3F5554BA75A5A5B9E846F135D80B56B9E83006E58ACF415D574464D4D1E056143ACCACF0EFA14275529D8BCA3825485B4F97FA6D1D231B7E46EAE7783CE8426E9D337D7BADEA65A3AFB504EE38E476A2479128ACDB5A01B25EB5AAB18D9CAEE08694B5A05481776D72FDACD2A44B1D64419B856141B55AF714F8D27A27EE93B51224BDC575022AD40FB53A25DAD2B9445D7570D657B07B90925EFE5AA20F9D2EE1865A75645291777C7D98FE4472547A398DA22E5E96551B58AE7202F64DB3F6D342A5B26E2100CCF0B0B4C55F3564A43D833023DEF773EE22C0D6D2130A182CD41E96CFCC0FEFBECDCFA42F2DFF95AE12A15F01D3E59BCD9C7036622BB7542DA36206CF85E205E68EC3FD3F8BB902EBFAF22EDF94DE05538F5B93FF579A34BFB8DDC6F36FC1EE5F26AF36E11F5E6C4BBDF0558E3EDAB2EB385C08DD67C8CC3C172E8FC91AAF4C9F8D7A74CEB844C632C217D724AFE3C9003874C9D59D7FD3587C37ADB7DC0947BD074D9D11D1E6DA2FC7F4C91CD667EFB9CD8392666CFE5D00966126F35636FFBF0D43641760E906DB0AD23DD9166CBAACFEB8961DB38D998408F3341369B1BE448E5AF3BC84DC5166B08F3B71E017E8D1DA5CC58CC654152CBA242C42A7813D03440EA5CC69ACDA9AF71DB07A5D217ED33E5098A5C873308C6629AE828D1E83284335EFBB269C8BEE9FC744CAEDB3C98466993FF255C403319BA0053F131613C28EDBE69A9BB1D10268BF267CEDCA536CFDD625522DD4AB123501EBE32F91F208C3882A9A9F0E80B1C62DBA3824FB0A0FEAAE851BB41B65F443DEC832B4671DC0A558EB1D6C75F91C341B87CFF2FAB15BCB0E41C0000 , N'6.4.4')
END

IF @CurrentMigration < '202202182115493_AddPostAbstract'
BEGIN
    ALTER TABLE [dbo].[Posts] ADD [Abstract] [nvarchar](max)
    UPDATE dbo.Posts SET Abstract = LEFT(Content, 100) WHERE Abstract IS NULL
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202202182115493_AddPostAbstract', N'MigrationsDemo.Migrations.Configuration',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9797D6B077917592C2E83A0EA264D1B78096C60E518A54452AB051F4CBFAD04FEA2F74A89B254AF22DEB4D8B05820D397338333C339C51FEF9EBEFC18765C8C90BC48A493174CE7AA70E01E1CB8089C5D049F4FCDD8FCE87F7DF7E33B80EC225F95CC85D1839D4146AE83C6B1DF55D57F9CF1052D50B991F4B25E7BAE7CBD0A58174CF4F4F7F72CFCE5C400807B10819DC2742B310D25FF0D791143E443AA17C2203E02A5FC71D2F4525B7340415511F86CE842D62AAD10A7505A174C8256714ADF080CF1D4285903ADDED3F2AF0742CC5C28B7081F28755042837A75C416E7B7F2DBEAB1BA7E7C60D77AD5840F989D232DC13F0EC228F8B6BAB1F145DA78C1B46EE1A23AC57C6EB347A43E723970B87D807F5473C364276607B46FC84D4174F4A062051CCBF13324AB84E62180A48744CF909B94B669CF9BFC0EA41FE06622812CEAB76A165B8575BC0A5BB584610EBD53DCC2BD68E0387B8755DD7562E552DBDCCA7B1D017E70EB94523E88C4379FD15FF3D2D63F81904A09F10DC51AD21C6DB1B079006B06181759EF9599C867CC3B471C8842E3F8158E8670C2A5D3AE4862D212856720B1E05C32C43251D27B0ED90C7981FFD8C7B0C8701DE1C380BE396BEB0451A470BED4E2AAD1C720F3C63CF338BB21CED999DA78C8B37B10CEF25CFC5D3C5A7071A2F40A319D2DEF16412FB960903774DF38DE437307B90DF88BF21F9CDF18790BFD0FB5AE47F609A6F623FD6A62FC04C7C1D34DA73F40CD8AD74EC9A0119C5F74F8082E6CD042852639704B8544AFA2C3DBAC28DECD8BA03D722209D3664012FACC69823E1598414C72387CE0F8D68B4819519BD06CBBCAF839D39765E4CC51570D0402EFDEC451D51E5D3A079071883A0BE82A904B1E130E5C81E85C9C9846EE61D133E8B28EF32D952D8E39D324695F0F6CE1544204C8675C5FD75E796F05690B6C564E05648D32CA6260B5103E28A0169662EDB0A2B765F796D5579F2D94431981EE80A1ABE176B32D798D260595D397F6C1ACA19672DE58A9375843C272BFB8D84B563BD29774A234BFB1A57B5295B2AEA796C6CD2D71D69A909E58DADDB6937EBA78BBEDBED68BC07131A4558642B8D78BE42BCAC0B1FBDF3F66F51C30CC3F5554BA75A5A5B9E846F135D80B56B9E83006E58ACF415D574464D4D1E056143ACCACF0EFA14275529D8BCA3825485B4F97FA6D1D231B7E46EAE7783CE8426E9D337D7BADEA65A3AFB504EE38E476A2479128ACDB5A01B25EB5AAB18D9CAEE08694B5A05481776D72FDACD2A44B1D64419B856141B55AF714F8D27A27EE93B51224BDC575022AD40FB53A25DAD2B9445D7570D657B07B90925EFE5AA20F9D2EE1865A75645291777C7D98FE4472547A398DA22E5E96551B58AE7202F64DB3F6D342A5B26E2100CCF0B0B4C55F3564A43D833023DEF773EE22C0D6D2130A182CD41E96CFCC0FEFBECDCFA42F2DFF95AE12A15F01D3E59BCD9C7036622BB7542DA36206CF85E205E68EC3FD3F8BB902EBFAF22EDF94DE05538F5B93FF579A34BFB8DDC6F36FC1EE5F26AF36E11F5E6C4BBDF0558E3EDAB2EB385C08DD67C8CC3C172E8FC91AAF4C9F8D7A74CEB844C632C217D724AFE3C9003874C9D59D7FD3587C37ADB7DC0947BD074D9D11D1E6DA2FC7F4C91CD667EFB9CD8392666CFE5D00966126F35636FFBF0D43641760E906DB0AD23DD9166CBAACFEB8961DB38D998408F3341369B1BE448E5AF3BC84DC5166B08F3B71E017E8D1DA5CC58CC654152CBA242C42A7813D03440EA5CC69ACDA9AF71DB07A5D217ED33E5098A5C873308C6629AE828D1E83284335EFBB269C8BEE9FC744CAEDB3C98466993FF255C403319BA0053F131613C28EDBE69A9BB1D10268BF267CEDCA536CFDD625522DD4AB123501EBE32F91F208C3882A9A9F0E80B1C62DBA3824FB0A0FEAAE851BB41B65F443DEC832B4671DC0A558EB1D6C75F91C341B87CFF2FAB15BCB0E41C0000 , N'6.4.4')
END

